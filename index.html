<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Øµ â†’ ÙƒÙ„Ø§Ù… | Ù…Ø­ÙˆÙ„ Ø§Ù„Ù†Øµ Ù„ØµÙˆØª Ø¹Ø±Ø¨ÙŠ MP3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', 'Segoe UI', Tahoma, sans-serif;
        }

        body {
            background: linear-gradient(145deg, #1a4c4c 0%, #1e5555 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 30px;
            box-shadow: 0 25px 50px -8px rgba(0, 0, 0, 0.4);
            padding: 40px;
            width: 100%;
            max-width: 800px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        h1 {
            color: #1e5555;
            margin-bottom: 15px;
            font-size: 2.2em;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 3px solid #1e5555;
            padding-bottom: 15px;
        }

        .subtitle {
            color: #2c7a7a;
            margin-bottom: 30px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #1e5555;
            font-weight: 700;
            font-size: 1.1em;
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 20px;
            border: 3px solid #b7d7d7;
            border-radius: 20px;
            font-size: 20px;
            resize: vertical;
            transition: all 0.3s;
            background: #f4fbfb;
            color: #0a3b3b;
            line-height: 1.8;
            font-weight: 500;
        }

        textarea:focus {
            border-color: #1e5555;
            outline: none;
            background: white;
            box-shadow: 0 0 0 4px rgba(30, 85, 85, 0.1);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
            background: #e8f3f3;
            padding: 20px;
            border-radius: 20px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-item label {
            margin-bottom: 0;
            font-size: 0.95em;
            color: #1e5555;
        }

        select {
            padding: 12px 15px;
            border: 2px solid #b7d7d7;
            border-radius: 15px;
            font-size: 16px;
            background: white;
            color: #1e5555;
            cursor: pointer;
            transition: all 0.3s;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%231e5555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: left 15px center;
            background-size: 20px;
            padding-left: 45px;
        }

        select:hover {
            border-color: #1e5555;
        }

        .arabic-badge {
            background: #1e5555;
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 14px;
            display: inline-block;
            margin-bottom: 10px;
        }

        .buttons-group {
            display: flex;
            gap: 15px;
            margin: 30px 0 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
            min-width: 180px;
        }

        .btn-speak {
            background: linear-gradient(145deg, #1e5555, #154242);
            color: white;
            box-shadow: 0 10px 20px -5px rgba(30, 85, 85, 0.5);
        }

        .btn-download {
            background: linear-gradient(145deg, #2c7a7a, #1e5555);
            color: white;
            box-shadow: 0 10px 20px -5px rgba(44, 122, 122, 0.5);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.4);
        }

        .audio-player-container {
            background: #e8f3f3;
            padding: 20px;
            border-radius: 20px;
            margin-top: 20px;
        }

        audio {
            width: 100%;
            border-radius: 30px;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 15px;
            display: none;
            font-weight: 600;
        }

        .status.active {
            display: block;
        }

        .status-success {
            background: #d4edda;
            color: #1e5555;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #d1ecf1;
            color: #1e5555;
            border: 1px solid #bee5eb;
        }

        .counter {
            text-align: left;
            color: #1e5555;
            margin-top: 5px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .voice-note {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 14px;
            border-right: 4px solid #1e5555;
        }

        @media (max-width: 600px) {
            .card {
                padding: 25px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .btn {
                padding: 12px 20px;
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>
            <span>ğŸ™ï¸ Ù…Ø­ÙˆÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù… Ø¹Ø±Ø¨ÙŠ</span>
        </h1>
        <div class="arabic-badge">
            ğŸ‡¸ğŸ‡¦ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù„Ù‡Ø¬Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ ÙˆØ§Ù„Ù…Ø­Ù„ÙŠØ©
        </div>
        <div class="subtitle">
            âœï¸ Ø§ÙƒØªØ¨ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ø³ØªÙ…Ø¹ Ø¨ØµÙˆØª Ø¹Ø±Ø¨ÙŠ Ø·Ø¨ÙŠØ¹ÙŠ - ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± MP3
        </div>

        <div class="voice-note" id="voiceNote">
            âš¡ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©... ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
        </div>

        <div class="input-group">
            <label>ğŸ“ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ</label>
            <textarea id="textInput" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ Ø£Ùˆ Ø§Ù„Ø¹Ø§Ù…ÙŠØ©..."></textarea>
            <div class="counter">
                Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø±ÙˆÙ: <span id="charCount">0</span> / 1000
            </div>
        </div>

        <div class="controls-grid">
            <div class="control-item">
                <label>ğŸ¤ Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØª Ø§Ù„Ø¹Ø±Ø¨ÙŠ</label>
                <select id="voiceSelect">
                    <option value="">ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©...</option>
                </select>
            </div>
            <div class="control-item">
                <label>âš¡ Ø³Ø±Ø¹Ø© Ø§Ù„ÙƒÙ„Ø§Ù…</label>
                <select id="speedSelect">
                    <option value="0.5">ğŸ¢ Ø¨Ø·ÙŠØ¡ Ø¬Ø¯Ø§Ù‹</option>
                    <option value="0.75">ğŸ¢ Ø¨Ø·ÙŠØ¡</option>
                    <option value="1" selected>â–¶ï¸ Ø·Ø¨ÙŠØ¹ÙŠ</option>
                    <option value="1.25">ğŸ‡ Ø³Ø±ÙŠØ¹</option>
                    <option value="1.5">ğŸ‡ Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹</option>
                </select>
            </div>
            <div class="control-item">
                <label>ğŸµ Ù†Ø¨Ø±Ø© Ø§Ù„ØµÙˆØª</label>
                <select id="pitchSelect">
                    <option value="0.5">ğŸ”½ Ù…Ù†Ø®ÙØ¶Ø©</option>
                    <option value="0.75">ğŸ”½ Ù…Ù†Ø®ÙØ¶Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹</option>
                    <option value="1" selected>â–¶ï¸ Ø¹Ø§Ø¯ÙŠØ©</option>
                    <option value="1.25">ğŸ”¼ Ù…Ø±ØªÙØ¹Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹</option>
                    <option value="1.5">ğŸ”¼ Ù…Ø±ØªÙØ¹Ø©</option>
                </select>
            </div>
        </div>

        <div class="buttons-group">
            <button id="speakBtn" class="btn btn-speak">
                <span>ğŸ”Š</span> ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
            </button>
            <button id="downloadBtn" class="btn btn-download">
                <span>ğŸ’¾</span> ØªØ­Ù…ÙŠÙ„ MP3 Ø¹Ø±Ø¨ÙŠ
            </button>
        </div>

        <div id="status" class="status"></div>

        <div id="audioPlayerContainer" style="display: none;">
            <div class="audio-player-container">
                <audio id="audioPlayer" controls controlsList="nodownload">
                    Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª
                </audio>
            </div>
        </div>
    </div>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
        const synth = window.speechSynthesis;
        let voices = [];
        let arabicVoices = [];
        let currentAudioUrl = null;
        let mediaRecorder = null;
        let audioChunks = [];

        // Ø¹Ù†Ø§ØµØ± DOM
        const textInput = document.getElementById('textInput');
        const voiceSelect = document.getElementById('voiceSelect');
        const speedSelect = document.getElementById('speedSelect');
        const pitchSelect = document.getElementById('pitchSelect');
        const speakBtn = document.getElementById('speakBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const statusEl = document.getElementById('status');
        const audioPlayer = document.getElementById('audioPlayer');
        const audioPlayerContainer = document.getElementById('audioPlayerContainer');
        const charCount = document.getElementById('charCount');
        const voiceNote = document.getElementById('voiceNote');

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø±ÙˆÙ
        textInput.addEventListener('input', function() {
            const count = this.value.length;
            charCount.textContent = count;
            
            if (count > 1000) {
                this.value = this.value.substring(0, 1000);
                charCount.textContent = 1000;
                showStatus('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 1000 Ø­Ø±Ù', 'error');
            }
        });

        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø©
        function showStatus(message, type = 'info') {
            statusEl.textContent = message;
            statusEl.className = 'status active';
            
            switch(type) {
                case 'success':
                    statusEl.classList.add('status-success');
                    break;
                case 'error':
                    statusEl.classList.add('status-error');
                    break;
                default:
                    statusEl.classList.add('status-info');
            }

            setTimeout(() => {
                statusEl.classList.remove('active');
            }, 4000);
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·
        function loadArabicVoices() {
            voices = synth.getVoices();
            
            // ØªØµÙÙŠØ© Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·
            arabicVoices = voices.filter(voice => 
                voice.lang.includes('ar') || 
                voice.lang.includes('ara') ||
                voice.name.includes('Arabic') ||
                voice.name.includes('Ø¹Ø±Ø¨ÙŠ')
            );

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
            voiceSelect.innerHTML = '';

            if (arabicVoices.length > 0) {
                voiceNote.style.display = 'none';
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                arabicVoices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = voice.name;
                    
                    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ø³Ù… Ø§Ù„ØµÙˆØª
                    let voiceName = voice.name;
                    if (voice.name.includes('Microsoft')) {
                        voiceName = voice.name.replace('Microsoft', 'Ù…Ø§ÙŠÙƒØ±ÙˆØ³ÙˆÙØª');
                    }
                    
                    option.textContent = `ğŸ‡¸ğŸ‡¦ ${voiceName} - ${voice.lang}`;
                    
                    // Ø¬Ø¹Ù„ Ø£ÙˆÙ„ ØµÙˆØª Ø¹Ø±Ø¨ÙŠ Ù‡Ùˆ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
                    if (index === 0) {
                        option.selected = true;
                    }
                    
                    voiceSelect.appendChild(option);
                });

                showStatus(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${arabicVoices.length} ØµÙˆØª Ø¹Ø±Ø¨ÙŠ`, 'success');
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ØµÙˆØ§Øª Ø¹Ø±Ø¨ÙŠØ©
                voiceSelect.innerHTML = '<option value="">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙˆØ§Øª Ø¹Ø±Ø¨ÙŠØ© - Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©</option>';
                voiceNote.innerHTML = 'âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ØµÙˆØ§Øª Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ù…ØªØµÙØ­Ùƒ. Ø¬Ø±Ø¨ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ù„ÙˆÙ„:<br>' +
                    '1ï¸âƒ£ Ø§Ø³ØªØ®Ø¯Ù… Ù…ØªØµÙØ­ ÙƒØ±ÙˆÙ… Ø£Ùˆ ÙØ§ÙŠØ±ÙÙˆÙƒØ³<br>' +
                    '2ï¸âƒ£ Ø«Ø¨Øª Ø­Ø²Ù…Ø© Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­<br>' +
                    '3ï¸âƒ£ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Øµ Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø©: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ…"';
                voiceNote.style.background = '#fff3cd';
                voiceNote.style.color = '#856404';
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ±Ù‡Ø§
        loadArabicVoices();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadArabicVoices;
        }

        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© Ø­ØªÙ‰ ØªØ¸Ù‡Ø±
        let attempts = 0;
        const loadInterval = setInterval(() => {
            if (arabicVoices.length === 0 && attempts < 20) {
                loadArabicVoices();
                attempts++;
            } else {
                clearInterval(loadInterval);
            }
        }, 500);

        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        function speakArabic(text, callback) {
            // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ÙƒÙ„Ø§Ù… Ø³Ø§Ø¨Ù‚
            synth.cancel();

            const utterance = new SpeechSynthesisUtterance(text);
            
            // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØª Ø§Ù„Ø¹Ø±Ø¨ÙŠ
            if (arabicVoices.length > 0) {
                const selectedVoiceName = voiceSelect.value;
                let selectedVoice = arabicVoices.find(v => v.name === selectedVoiceName);
                
                if (!selectedVoice) {
                    // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØªØŒ Ø§Ø®ØªØ± Ø£ÙˆÙ„ ØµÙˆØª Ø¹Ø±Ø¨ÙŠ
                    selectedVoice = arabicVoices[0];
                }
                
                utterance.voice = selectedVoice;
                console.log('Using Arabic voice:', selectedVoice.name);
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª
            utterance.rate = parseFloat(speedSelect.value);
            utterance.pitch = parseFloat(pitchSelect.value);
            utterance.lang = 'ar-SA'; // Ø¶Ø¨Ø· Ø§Ù„Ù„ØºØ© Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ­Ø¯Ø«
            utterance.onstart = () => {
                showStatus('ğŸ”Š Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©...', 'info');
            };

            utterance.onend = () => {
                showStatus('âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„ØªØ­Ø¯Ø«', 'success');
                if (callback) callback();
            };

            utterance.onerror = (event) => {
                console.error('Speech error:', event);
                showStatus('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯Ø« - ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£ØµÙˆØ§Øª Ø¹Ø±Ø¨ÙŠØ©', 'error');
            };

            // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
            synth.speak(utterance);
            
            // Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹: Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ speech synthesis Ø¥Ø°Ø§ ØªÙˆÙ‚Ù
            if (synth.paused) {
                synth.resume();
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª ÙˆØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù€ MP3
        async function recordArabicSpeech(text) {
            return new Promise((resolve, reject) => {
                try {
                    // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø³Ø§Ø¨Ù‚
                    if (mediaRecorder && mediaRecorder.state === 'recording') {
                        mediaRecorder.stop();
                    }

                    // Ø¥Ù†Ø´Ø§Ø¡ AudioContext
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ MediaStreamDestination
                    const destination = audioContext.createMediaStreamDestination();
                    
                    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³Ø¬Ù„
                    audioChunks = [];
                    mediaRecorder = new MediaRecorder(destination.stream);
                    
                    mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            audioChunks.push(event.data);
                        }
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/mp3' });
                        const url = URL.createObjectURL(audioBlob);
                        
                        // Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ù…Ø´ØºÙ„
                        audioPlayer.src = url;
                        audioPlayerContainer.style.display = 'block';
                        
                        if (currentAudioUrl) {
                            URL.revokeObjectURL(currentAudioUrl);
                        }
                        currentAudioUrl = url;
                        
                        resolve(url);
                    };
                    
                    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                    mediaRecorder.start();
                    
                    // Ø§Ù„ØªØ­Ø¯Ø« Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    if (arabicVoices.length > 0) {
                        utterance.voice = arabicVoices[0];
                    }
                    
                    utterance.rate = parseFloat(speedSelect.value);
                    utterance.pitch = parseFloat(pitchSelect.value);
                    utterance.lang = 'ar-SA';
                    
                    // Ø±Ø¨Ø· Ø§Ù„ØµÙˆØª Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                    const source = audioContext.createMediaElementSource(new Audio());
                    source.connect(destination);
                    
                    utterance.onend = () => {
                        mediaRecorder.stop();
                        audioContext.close();
                    };
                    
                    synth.speak(utterance);
                    
                } catch (error) {
                    console.error('Recording error:', error);
                    reject(error);
                }
            });
        }

        // Ø­Ø¯Ø« Ø²Ø± Ø§Ù„ØªØ­Ø¯Ø«
        speakBtn.addEventListener('click', function() {
            const text = textInput.value.trim();
            
            if (!text) {
                showStatus('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 'error');
                textInput.focus();
                return;
            }

            if (arabicVoices.length === 0) {
                showStatus('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙˆØ§Øª Ø¹Ø±Ø¨ÙŠØ©. Ø¬Ø±Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Ø¢Ø®Ø±', 'error');
                return;
            }

            speakBtn.disabled = true;
            speakArabic(text, () => {
                speakBtn.disabled = false;
            });
        });

        // Ø­Ø¯Ø« Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        downloadBtn.addEventListener('click', async function() {
            const text = textInput.value.trim();
            
            if (!text) {
                showStatus('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 'error');
                textInput.focus();
                return;
            }

            if (arabicVoices.length === 0) {
                showStatus('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙˆØ§Øª Ø¹Ø±Ø¨ÙŠØ©. Ø¬Ø±Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©', 'error');
                return;
            }

            downloadBtn.disabled = true;
            speakBtn.disabled = true;
            
            showStatus('â³ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙŠ...', 'info');
            
            try {
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª
                await recordArabicSpeech(text);
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                setTimeout(() => {
                    if (currentAudioUrl) {
                        const a = document.createElement('a');
                        a.href = currentAudioUrl;
                        a.download = `ÙƒÙ„Ø§Ù…-Ø¹Ø±Ø¨ÙŠ-${Date.now()}.mp3`;
                        a.click();
                        showStatus('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØµÙˆØªÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Download error:', error);
                showStatus('âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù - Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„ØªØ­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹', 'error');
            } finally {
                downloadBtn.disabled = false;
                speakBtn.disabled = false;
            }
        });

        // Ù†Øµ ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¹Ø±Ø¨ÙŠ
        const arabicExamples = [
            'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…ÙˆÙ‚Ø¹ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ø§Ù… Ø¹Ø±Ø¨ÙŠ',
            'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ù† Ø£Ø¬Ù…Ù„ Ù„ØºØ§Øª Ø§Ù„Ø¹Ø§Ù„Ù…',
            'ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­ÙˆÙŠÙ„ Ø£ÙŠ Ù†Øµ Ø¹Ø±Ø¨ÙŠ Ø¥Ù„Ù‰ ØµÙˆØª Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©',
            'Ù†ØªÙ…Ù†Ù‰ Ù„ÙƒÙ… ØªØ¬Ø±Ø¨Ø© Ù…Ù…ØªØ¹Ø© Ù…Ø¹ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',
            'Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù„Ù‡Ø¬Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…Ø®ØªÙ„ÙØ©'
        ];

        // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ ÙƒÙ„ 3 Ø«ÙˆØ§Ù†ÙŠ
        let exampleIndex = 0;
        setInterval(() => {
            if (!textInput.value && !textInput.matches(':focus')) {
                textInput.placeholder = `âœï¸ Ù…Ø«Ø§Ù„: ${arabicExamples[exampleIndex]}`;
                exampleIndex = (exampleIndex + 1) % arabicExamples.length;
            }
        }, 3000);

        // ØªØ¹ÙŠÙŠÙ† Ù†Øµ Ø¹Ø±Ø¨ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        window.onload = function() {
            textInput.placeholder = 'âœï¸ Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© - Ù…Ø«Ø§Ù„: Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡';
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
            setTimeout(() => {
                if (arabicVoices.length === 0) {
                    loadArabicVoices();
                }
            }, 1000);
        };

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
        window.addEventListener('beforeunload', function() {
            if (currentAudioUrl) {
                URL.revokeObjectURL(currentAudioUrl);
            }
            synth.cancel();
        });

        // Ø¯Ø¹Ù… Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù…Ù† Ø§Ù„Ø­Ø§ÙØ¸Ø©
        textInput.addEventListener('paste', function(e) {
            const pastedText = e.clipboardData.getData('text');
            const arabicRegex = /[\u0600-\u06FF]/;
            
            if (!arabicRegex.test(pastedText) && pastedText.length > 0) {
                showStatus('ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…ØµÙ…Ù… Ø®ØµÙŠØµØ§Ù‹ Ù„Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ', 'info');
            }
        });

        console.log('âœ… Ù…ÙˆÙ‚Ø¹ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø¬Ø§Ù‡Ø²!');
    </script>
</body>
</html>
