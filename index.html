<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Ø¹Ø±Ø´ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ ğŸ‘‘ - Ø§Ù„Ù…Ù„Ùƒ ÙˆØ§Ù„Ø®Ø§Ø³Ø±</title>
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      user-select: none;
      font-family: 'Cairo', sans-serif;
    }
    body {
      background: radial-gradient(circle at 20% 30%, #1a0e0b, #0a0709);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 16px;
    }
    .game {
      background: rgba(18, 12, 20, 0.9);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 2px solid rgba(212, 175, 55, 0.5);
      border-radius: 64px;
      padding: 28px 22px;
      max-width: 1000px;
      width: 100%;
      box-shadow: 0 30px 60px #000000, 0 0 0 2px #d4af37 inset;
      text-align: center;
    }

    h1 {
      font-size: 2.3rem;
      font-weight: 900;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      text-shadow: 0 0 25px #ffd966, 0 0 45px #d4af37;
    }
    h1 i {
      color: #ffd700;
      filter: drop-shadow(0 0 15px gold);
    }

    .sub {
      background: #1e1510e0;
      padding: 12px 28px;
      border-radius: 60px;
      display: inline-block;
      margin: 10px 0 18px;
      border: 2px solid #d4af37;
      font-size: 1.2rem;
      font-weight: 700;
      color: #ffd966;
    }

    /* Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (2-4) */
    .player-selector {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 10px 0 25px;
      flex-wrap: wrap;
    }
    .player-option {
      background: #2a1f2a;
      border-radius: 60px;
      padding: 6px;
      border: 2px solid transparent;
      transition: 0.2s;
    }
    .player-option.active {
      border: 2px solid #ffd966;
      background: #3e2a3e;
      box-shadow: 0 0 25px #ffbf00;
    }
    .player-btn {
      background: #3a2e3a;
      border: none;
      color: #f0e6d2;
      font-size: 1.25rem;
      font-weight: bold;
      padding: 12px 30px;
      border-radius: 50px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: 0.15s;
    }
    .player-btn i {
      font-size: 1.6rem;
    }
    .player-btn.active {
      background: #d4af37;
      color: #0a0505;
      box-shadow: 0 0 35px #ffbf00;
    }
    .player-btn.active i {
      color: #1a0e0b;
    }

    /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ù„ÙƒÙŠØ© */
    .players-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin: 25px 0 20px;
    }
    .player-card {
      flex: 1 1 170px;
      min-width: 160px;
      background: linear-gradient(145deg, #1a131f, #0f0a12);
      border-radius: 48px;
      padding: 20px 12px;
      box-shadow: 0 15px 25px #00000080;
      transition: 0.2s;
      border: 3px solid;
      position: relative;
      backdrop-filter: blur(4px);
    }
    /* ØªØ§Ø¬ Ø§Ù„Ù…Ù„Ùƒ Ø£Ùˆ Ø¬Ù„Ø¯ Ø§Ù„Ø®Ø§Ø³Ø± */
    .crown-icon, .loser-icon {
      position: absolute;
      top: -16px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2.2rem;
      filter: drop-shadow(0 0 10px gold);
      z-index: 10;
    }
    .loser-icon {
      color: #6a6a6a;
      filter: drop-shadow(0 0 8px #3a3a3a);
      top: -12px;
    }
    .player-name {
      font-size: 1.7rem;
      font-weight: 900;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    .player-score {
      font-size: 2.4rem;
      font-weight: 900;
      background: #00000070;
      border-radius: 80px;
      padding: 10px 16px;
      width: fit-content;
      margin: 8px auto;
      border: 2px solid #ffffff70;
    }
    .click-btn {
      width: 100%;
      padding: 16px 0;
      border-radius: 60px;
      border: none;
      font-size: 1.4rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-top: 12px;
      cursor: pointer;
      transition: 0.06s;
      border: 2px solid white;
    }
    .click-btn:active {
      transform: scale(0.9);
    }
    .click-btn:disabled {
      opacity: 0.5;
      filter: grayscale(1);
      transform: none;
    }

    /* Ø¹Ø±Ø´ Ø§Ù„Ù…Ù„Ùƒ ÙˆØ§Ù„Ø®Ø§Ø³Ø± - Ù‚Ø³Ù… Ø§Ù„Ø¯Ø±Ø§Ù…Ø§ */
    .throne-room {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #0f080ec0;
      border-radius: 80px;
      padding: 16px 24px;
      margin: 25px 0 15px;
      border: 2px solid #b4945c;
      backdrop-filter: blur(8px);
    }
    .king-area, .loser-area {
      display: flex;
      align-items: center;
      gap: 18px;
      font-size: 1.5rem;
    }
    .king-label {
      background: #ffd700;
      color: #1a0e0b;
      padding: 10px 26px;
      border-radius: 60px;
      font-weight: 900;
      font-size: 1.7rem;
      box-shadow: 0 0 35px gold;
    }
    .loser-label {
      background: #3a3a4a;
      color: #dfdfdf;
      padding: 10px 26px;
      border-radius: 60px;
      font-weight: 900;
      font-size: 1.6rem;
      box-shadow: 0 0 20px #1e1e1e;
    }
    .timer-global {
      background: #1a0f1c;
      border-radius: 60px;
      padding: 12px 24px;
      margin: 8px 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid #d4af37;
    }
    .timer-box {
      font-size: 2.1rem;
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    #globalTime {
      background: #00000080;
      padding: 6px 24px;
      border-radius: 50px;
      color: #ffe082;
    }
    .progress {
      width: 100%;
      height: 16px;
      background: #2a1f2f;
      border-radius: 20px;
      margin-top: 10px;
    }
    #progressFill {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #e4b138, #ffd966);
      border-radius: 20px;
      transition: width 0.15s;
      box-shadow: 0 0 16px #ffbf00;
    }
    .control-panel {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin: 20px 0 8px;
      flex-wrap: wrap;
    }
    .ctrl-btn {
      background: #2a1e32;
      border: 2px solid #b4945c;
      color: #ffd966;
      padding: 14px 30px;
      border-radius: 60px;
      font-size: 1.2rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: 0.15s;
    }
    .ctrl-btn:hover {
      background: #4f3462;
      border-color: #ffd966;
      color: white;
    }
  </style>
</head>
<body>
  <div class="game">
    <h1>
      <i class="fas fa-crown"></i> Ø¹Ø±Ø´ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„
      <i class="fas fa-throne"></i>
    </h1>
    <div class="sub">
      <i class="fas fa-users-between-lines"></i> Ø§Ù„Ù…Ù„Ùƒ Ø£Ø¹Ù„Ù‰ Ø±Ù‚Ù… .. Ø§Ù„Ø®Ø§Ø³Ø± Ø£Ù‚Ù„ Ø±Ù‚Ù…
    </div>

    <!-- Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†: 2 Ø£Ùˆ 3 Ø£Ùˆ 4 -->
    <div class="player-selector">
      <div class="player-option" id="option2">
        <button id="select2Players" class="player-btn"><i class="fas fa-user-friends"></i> 2</button>
      </div>
      <div class="player-option" id="option3">
        <button id="select3Players" class="player-btn"><i class="fas fa-users"></i> 3</button>
      </div>
      <div class="player-option" id="option4">
        <button id="select4Players" class="player-btn"><i class="fas fa-people-arrows"></i> 4</button>
      </div>
    </div>

    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
    <div id="playersContainer" class="players-grid"></div>

    <!-- â³ Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø¹Ø§Ù… -->
    <div class="timer-global">
      <div class="timer-box">
        <i class="fas fa-hourglass-half"></i>
        <span id="globalTime">10.0</span>
      </div>
      <div style="font-size:1.4rem;">
        <i class="fas fa-fist-raised"></i> Ø§Ø¶Ø±Ø¨ Ø¨Ù„Ø§ Ø±Ø­Ù…Ø©
      </div>
    </div>
    <div class="progress">
      <div id="progressFill" style="width:100%;"></div>
    </div>

    <!-- ğŸ† ØºØ±ÙØ© Ø§Ù„Ø¹Ø±Ø´: Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ù…ØªÙˆØ¬ Ùˆ Ø§Ù„Ø®Ø§Ø³Ø± Ø§Ù„Ø°Ù„ÙŠÙ„ -->
    <div class="throne-room">
      <div class="king-area">
        <i class="fas fa-crown" style="font-size:2.5rem; color:#ffd700;"></i>
        <span class="king-label" id="kingName">Ù„Ø§ Ù…Ù„Ùƒ</span>
      </div>
      <div class="loser-area">
        <i class="fas fa-broken" style="font-size:2rem; color:#a0a0a0;"></i>
        <span class="loser-label" id="loserName">Ù„Ø§ Ø®Ø§Ø³Ø±</span>
      </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="control-panel">
      <button id="resetGameBtn" class="ctrl-btn"><i class="fas fa-rotate-right"></i> Ù…Ø¹Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
      <button id="hardGlobalBtn" class="ctrl-btn"><i class="fas fa-skull"></i> ØªØ­Ø¯Ù (Ù†Ø§Ù‚Øµ Ø§Ù„ÙˆÙ‚Øª)</button>
    </div>
    <p style="margin-top:16px; opacity:0.9; font-size:1rem;">
      <i class="fas fa-crown" style="color:gold;"></i> Ø§Ù„Ù…Ù„Ùƒ = Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø· .. 
      <i class="fas fa-bug" style="color:#aaa;"></i> Ø§Ù„Ø®Ø§Ø³Ø± = Ø£Ù‚Ù„ Ù†Ù‚Ø§Ø·
    </p>
  </div>

  <script>
    (function() {
      "use strict";

      // -----------------------------------------------------------------
      // ğŸ‘‘ Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù†Ù‚Ø±: Ù…Ù„Ùƒ - Ø®Ø§Ø³Ø± - Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (2-4) ğŸ‘‘
      // -----------------------------------------------------------------

      const PLAYER_COLORS = [
        { name: 'Ø§Ù„Ø£Ø­Ù…Ø±', bg: '#b71c1c', light: '#f05545', btn: '#d32f2f', icon: 'fa-dragon', crown: '#ffb74d' },
        { name: 'Ø§Ù„Ø£Ø²Ø±Ù‚', bg: '#0d47a1', light: '#5472d3', btn: '#1565c0', icon: 'fa-whale', crown: '#80deea' },
        { name: 'Ø§Ù„Ø£Ø®Ø¶Ø±', bg: '#1b5e20', light: '#6ab04a', btn: '#2e7d32', icon: 'fa-tree', crown: '#a5d6a7' },
        { name: 'Ø§Ù„Ø°Ù‡Ø¨ÙŠ', bg: '#7d4e1a', light: '#ffb74d', btn: '#a5641e', icon: 'fa-lion', crown: '#ffd180' }
      ];

      // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù…Ù„ÙƒØ©
      let playersCount = 2;
      let players = [];
      let timeLeft = 10.0;
      let gameActive = false;
      let gameFinished = false;
      let globalTimer = null;
      let hardMode = false;      // ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠ: ÙƒÙ„ Ù†Ù‚Ø±Ø© ØªÙ†Ù‚Øµ 0.05 Ø« Ù…Ù† Ø§Ù„ÙˆÙ‚Øª

      // DOM elements
      const playersContainer = document.getElementById('playersContainer');
      const globalTimeEl = document.getElementById('globalTime');
      const progressFill = document.getElementById('progressFill');
      const kingNameEl = document.getElementById('kingName');
      const loserNameEl = document.getElementById('loserName');
      const resetBtn = document.getElementById('resetGameBtn');
      const hardGlobalBtn = document.getElementById('hardGlobalBtn');
      const select2Btn = document.getElementById('select2Players');
      const select3Btn = document.getElementById('select3Players');
      const select4Btn = document.getElementById('select4Players');
      const option2 = document.getElementById('option2');
      const option3 = document.getElementById('option3');
      const option4 = document.getElementById('option4');

      // ========== Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ø¯ ==========
      function initPlayers(count) {
        players = [];
        for (let i = 0; i < count; i++) {
          let colorIndex = i % PLAYER_COLORS.length;
          players.push({
            id: i,
            name: `Ø§Ù„Ù„Ø§Ø¹Ø¨ ${i+1}`,
            color: PLAYER_COLORS[colorIndex].bg,
            lightColor: PLAYER_COLORS[colorIndex].light,
            btnColor: PLAYER_COLORS[colorIndex].btn,
            icon: PLAYER_COLORS[colorIndex].icon,
            score: 0,
            isKing: false,
            isLoser: false,
          });
        }
        renderPlayers();
        updateKingAndLoser(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ùƒ ÙˆØ§Ù„Ø®Ø§Ø³ÙˆØ± ÙÙˆØ±Ø§Ù‹
      }

      // ========== Ø±Ø³Ù… Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ==========
      function renderPlayers() {
        let html = '';
        players.forEach((p, idx) => {
          html += `
            <div id="playerCard-${idx}" class="player-card" style="border-color: ${p.color}; background: linear-gradient(145deg, #1a1220, #0e0912);">
              <div id="crownIcon-${idx}" class="crown-icon" style="display: none;"><i class="fas fa-crown" style="color: gold; filter: drop-shadow(0 0 10px orange);"></i></div>
              <div id="loserIcon-${idx}" class="loser-icon" style="display: none;"><i class="fas fa-poop" style="color: #6b5a4b; filter: drop-shadow(0 0 5px #3a2a1a);"></i></div>
              <div class="player-name" style="color: ${p.lightColor};">
                <i class="fas ${p.icon}"></i> ${p.name}
              </div>
              <div id="playerScore-${idx}" class="player-score" style="color: white; background: ${p.color}dd; border: 3px solid ${p.lightColor};">
                ${p.score}
              </div>
              <button id="clickBtn-${idx}" class="click-btn" style="background: ${p.btnColor}; color: white; border-color: ${p.lightColor};">
                <i class="fas ${p.icon}"></i> Ø§Ø¶Ø±Ø¨
              </button>
            </div>
          `;
        });
        playersContainer.innerHTML = html;

        // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù†Ù‚Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        players.forEach((_, idx) => {
          const btn = document.getElementById(`clickBtn-${idx}`);
          if (btn) {
            // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø²Ø± Ù„ØªØ¬Ù†Ø¨ ØªÙƒØ±Ø§Ø± Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
            btn.replaceWith(btn.cloneNode(true));
            const newBtn = document.getElementById(`clickBtn-${idx}`);
            newBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              handlePlayerClick(idx);
            });
          }
        });
      }

      // ========== Ù†Ù‚Ø±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ ==========
      function handlePlayerClick(playerIndex) {
        if (timeLeft <= 0.0) return;
        if (!gameActive && !gameFinished) {
          startGlobalTimer();
          gameActive = true;
        }

        const player = players[playerIndex];
        player.score += 1;

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø·
        const scoreEl = document.getElementById(`playerScore-${playerIndex}`);
        if (scoreEl) scoreEl.textContent = player.score;

        // ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠ: ÙƒÙ„ Ù†Ù‚Ø±Ø© ØªØ®ØµÙ… Ù…Ù† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¹Ø§Ù… 0.05 Ø«Ø§Ù†ÙŠØ©
        if (hardMode && timeLeft > 0.05) {
          timeLeft = Math.max(0.0, timeLeft - 0.05);
          globalTimeEl.textContent = timeLeft.toFixed(1);
          updateProgressBar();
        }

        // Ø§Ù‡ØªØ²Ø§Ø²
        if (navigator.vibrate) navigator.vibrate(10);

        // Ø§Ù„Ø£Ù‡Ù…: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ùƒ Ùˆ Ø§Ù„Ø®Ø§Ø³Ø± (Ø£Ø¹Ù„Ù‰ ÙˆØ£Ù‚Ù„ Ù†Ù‚Ø§Ø·)
        updateKingAndLoser();

        // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¥Ø°Ø§ Ù†ÙØ¯ Ø§Ù„ÙˆÙ‚Øª
        if (timeLeft <= 0.0) {
          timeLeft = 0.0;
          globalTimeEl.textContent = '0.0';
          endGame();
        }
      }

      // ========== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ùƒ (Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·) Ùˆ Ø§Ù„Ø®Ø§Ø³Ø± (Ø£Ù‚Ù„ Ù†Ù‚Ø§Ø·) ==========
      function updateKingAndLoser() {
        if (!players.length) return;
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£Ù„Ù‚Ø§Ø¨ Ø§Ù„Ù…Ù„Ùƒ ÙˆØ§Ù„Ø®Ø§Ø³Ø±
        players.forEach(p => { p.isKing = false; p.isLoser = false; });

        // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø¹Ù„Ù‰ ÙˆØ£Ù‚Ù„ Ø¯Ø±Ø¬Ø©
        let maxScore = -Infinity;
        let minScore = Infinity;
        let kingIndex = 0;
        let loserIndex = 0;

        players.forEach((p, idx) => {
          if (p.score > maxScore) {
            maxScore = p.score;
            kingIndex = idx;
          }
          if (p.score < minScore) {
            minScore = p.score;
            loserIndex = idx;
          }
        });

        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹ 0 Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ùƒ ÙˆÙ„Ø§ Ø®Ø§Ø³Ø± Ø­ØªÙ‰ Ø£ÙˆÙ„ Ù†Ù‚Ø±Ø© (Ù†Ø¹Ø±Ø¶ â€”)
        if (maxScore === 0 && minScore === 0) {
          kingNameEl.textContent = 'Ù„Ø§ Ù…Ù„Ùƒ';
          loserNameEl.textContent = 'Ù„Ø§ Ø®Ø§Ø³Ø±';
        } else {
          // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù„Ùƒ
          players[kingIndex].isKing = true;
          kingNameEl.textContent = `${players[kingIndex].name} (${players[kingIndex].score})`;
          kingNameEl.style.background = players[kingIndex].color;
          kingNameEl.style.boxShadow = `0 0 40px ${players[kingIndex].lightColor}`;

          // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®Ø§Ø³Ø± (Ø£Ù‚Ù„ Ø¯Ø±Ø¬Ø©)
          players[loserIndex].isLoser = true;
          loserNameEl.textContent = `${players[loserIndex].name} (${players[loserIndex].score})`;
          loserNameEl.style.background = '#2a2a3a';
          loserNameEl.style.boxShadow = `0 0 20px #1e1e1e`;
        }

        // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ØªØ§Ø¬ Ø§Ù„Ù…Ù„Ùƒ Ùˆ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø®Ø§Ø³Ø± ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        players.forEach((p, idx) => {
          const crownIcon = document.getElementById(`crownIcon-${idx}`);
          const loserIcon = document.getElementById(`loserIcon-${idx}`);
          if (crownIcon) crownIcon.style.display = p.isKing ? 'block' : 'none';
          if (loserIcon) loserIcon.style.display = p.isLoser ? 'block' : 'none';
        });

        // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ù…Ù„Ùƒ ÙÙŠ Ø¨Ø·Ø§Ù‚ØªÙ‡ (Ø¥Ø·Ø§Ø± Ø°Ù‡Ø¨ÙŠ)
        players.forEach((p, idx) => {
          const card = document.getElementById(`playerCard-${idx}`);
          if (card) {
            if (p.isKing) {
              card.style.border = `5px solid gold`;
              card.style.boxShadow = `0 0 40px gold`;
            } else if (p.isLoser) {
              card.style.border = `3px solid #5a5a5a`;
              card.style.boxShadow = `0 0 15px #3a3a3a`;
            } else {
              card.style.border = `3px solid ${p.color}`;
              card.style.boxShadow = `0 15px 25px #00000080`;
            }
          }
        });
      }

      // ========== Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª ==========
      function startGlobalTimer() {
        if (globalTimer) clearInterval(globalTimer);
        globalTimer = setInterval(() => {
          if (timeLeft > 0.0) {
            timeLeft = Math.max(0.0, timeLeft - 0.1);
            globalTimeEl.textContent = timeLeft.toFixed(1);
            updateProgressBar();

            if (timeLeft <= 0.0) {
              timeLeft = 0.0;
              globalTimeEl.textContent = '0.0';
              endGame();
              clearInterval(globalTimer);
              globalTimer = null;
            }
          } else {
            endGame();
            clearInterval(globalTimer);
            globalTimer = null;
          }
        }, 100);
      }

      function updateProgressBar() {
        let percent = (timeLeft / 10) * 100;
        if (percent < 0) percent = 0;
        progressFill.style.width = `${percent}%`;
      }

      // ========== Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø¹Ø±ÙƒØ© ==========
      function endGame() {
        gameActive = false;
        gameFinished = true;
        // ØªØ¹Ø·ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        players.forEach((_, idx) => {
          const btn = document.getElementById(`clickBtn-${idx}`);
          if (btn) btn.disabled = true;
        });
        // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®ÙŠØ± Ù„Ù„Ù…Ù„Ùƒ ÙˆØ§Ù„Ø®Ø§Ø³Ø±
        updateKingAndLoser();
      }

      // ========== Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…Ù…Ù„ÙƒØ© ==========
      function fullReset() {
        if (globalTimer) {
          clearInterval(globalTimer);
          globalTimer = null;
        }
        gameActive = false;
        gameFinished = false;
        timeLeft = 10.0;
        globalTimeEl.textContent = '10.0';
        updateProgressBar();

        // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù†Ù‚Ø§Ø·
        players.forEach((p, idx) => {
          p.score = 0;
          p.isKing = false;
          p.isLoser = false;
          const scoreEl = document.getElementById(`playerScore-${idx}`);
          if (scoreEl) scoreEl.textContent = '0';
          const btn = document.getElementById(`clickBtn-${idx}`);
          if (btn) btn.disabled = false;
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ùƒ ÙˆØ§Ù„Ø®Ø§Ø³Ø± Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ø§ÙŠØ¯
        kingNameEl.textContent = 'Ù„Ø§ Ù…Ù„Ùƒ';
        loserNameEl.textContent = 'Ù„Ø§ Ø®Ø§Ø³Ø±';
        kingNameEl.style.background = '#ffd700';
        loserNameEl.style.background = '#3a3a4a';
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙŠØ¬Ø§Ù† ÙˆØ£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø®Ø§Ø³Ø±
        players.forEach((_, idx) => {
          const crownIcon = document.getElementById(`crownIcon-${idx}`);
          const loserIcon = document.getElementById(`loserIcon-${idx}`);
          if (crownIcon) crownIcon.style.display = 'none';
          if (loserIcon) loserIcon.style.display = 'none';
          
          const card = document.getElementById(`playerCard-${idx}`);
          if (card) {
            card.style.border = `3px solid ${players[idx]?.color || '#fff'}`;
            card.style.boxShadow = `0 15px 25px #00000080`;
          }
        });
      }

      // ========== ØªØºÙŠÙŠØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ==========
      function setPlayersCount(count) {
        playersCount = count;
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        option2.classList.remove('active');
        option3.classList.remove('active');
        option4.classList.remove('active');
        select2Btn.classList.remove('active');
        select3Btn.classList.remove('active');
        select4Btn.classList.remove('active');

        if (count === 2) {
          option2.classList.add('active');
          select2Btn.classList.add('active');
        } else if (count === 3) {
          option3.classList.add('active');
          select3Btn.classList.add('active');
        } else {
          option4.classList.add('active');
          select4Btn.classList.add('active');
        }

        fullReset();
        initPlayers(count);
      }

      // ========== ØªØ¨Ø¯ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠ ==========
      function toggleHardMode() {
        hardMode = !hardMode;
        if (hardMode) {
          hardGlobalBtn.style.background = '#7a2e2e';
          hardGlobalBtn.style.borderColor = '#ff8a5c';
          hardGlobalBtn.innerHTML = '<i class="fas fa-skull"></i> ØªØ­Ø¯Ù Ù†Ø´Ø·';
        } else {
          hardGlobalBtn.style.background = '#2a1e32';
          hardGlobalBtn.style.borderColor = '#b4945c';
          hardGlobalBtn.innerHTML = '<i class="fas fa-skull"></i> ØªØ­Ø¯Ù (Ù†Ø§Ù‚Øµ Ø§Ù„ÙˆÙ‚Øª)';
        }
      }

      // ========== Event Listeners ==========
      select2Btn.addEventListener('click', () => setPlayersCount(2));
      select3Btn.addEventListener('click', () => setPlayersCount(3));
      select4Btn.addEventListener('click', () => setPlayersCount(4));

      resetBtn.addEventListener('click', () => {
        fullReset();
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ù†ÙØ³ Ø§Ù„Ø¹Ø¯Ø¯ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
        initPlayers(playersCount);
      });

      hardGlobalBtn.addEventListener('click', toggleHardMode);

      // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„: Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ø«Ù†ÙŠÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
      setPlayersCount(2);

    })();
  </script>
</body>
</html>
